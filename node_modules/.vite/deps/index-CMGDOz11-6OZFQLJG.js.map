{
  "version": 3,
  "sources": ["../../@milkdown/crepe/src/feature/placeholder/index.ts"],
  "sourcesContent": ["import { $ctx, $prose } from '@milkdown/kit/utils'\nimport type { EditorState } from '@milkdown/kit/prose/state'\nimport { Plugin, PluginKey } from '@milkdown/kit/prose/state'\nimport type { Node } from '@milkdown/kit/prose/model'\nimport { Decoration, DecorationSet } from '@milkdown/kit/prose/view'\nimport { findParent } from '@milkdown/kit/prose'\nimport type { DefineFeature } from '../shared'\nimport { isInCodeBlock, isInList } from '../../utils'\n\nfunction isDocEmpty(doc: Node) {\n  return doc.childCount <= 1 && !doc.firstChild?.content.size\n}\n\nfunction createPlaceholderDecoration(\n  state: EditorState,\n  placeholderText: string,\n): Decoration | null {\n  const { selection } = state\n  if (!selection.empty)\n    return null\n\n  const $pos = selection.$anchor\n  const node = $pos.parent\n  if (node.content.size > 0)\n    return null\n\n  const inTable = findParent(node => node.type.name === 'table')($pos)\n  if (inTable)\n    return null\n\n  const before = $pos.before()\n\n  return Decoration.node(before, before + node.nodeSize, {\n    'class': 'crepe-placeholder',\n    'data-placeholder': placeholderText,\n  })\n}\n\ninterface PlaceholderConfig {\n  text: string\n  mode: 'doc' | 'block'\n}\n\nexport type PlaceHolderFeatureConfig = Partial<PlaceholderConfig>\n\nexport const placeholderConfig = $ctx({\n  text: 'Please enter...',\n  mode: 'block',\n} as PlaceholderConfig, 'placeholderConfigCtx')\n\nexport const placeholderPlugin = $prose((ctx) => {\n  return new Plugin({\n    key: new PluginKey('CREPE_PLACEHOLDER'),\n    props: {\n      decorations: (state) => {\n        const config = ctx.get(placeholderConfig.key)\n        if (config.mode === 'doc' && !isDocEmpty(state.doc))\n          return null\n\n        if (isInCodeBlock(state.selection) || isInList(state.selection))\n          return null\n\n        const placeholderText = config.text ?? 'Please enter...'\n        const deco = createPlaceholderDecoration(state, placeholderText)\n        if (!deco)\n          return null\n\n        return DecorationSet.create(state.doc, [deco])\n      },\n    },\n  })\n})\n\nexport const defineFeature: DefineFeature<PlaceHolderFeatureConfig> = (editor, config) => {\n  editor\n    .config((ctx) => {\n      if (config) {\n        ctx.update(placeholderConfig.key, (prev) => {\n          return {\n            ...prev,\n            ...config,\n          }\n        })\n      }\n    })\n    .use(placeholderPlugin)\n    .use(placeholderConfig)\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AASA,SAAS,WAAW,KAAW;AAT/B,MAAA;AAUE,SAAO,IAAI,cAAc,KAAK,GAAC,KAAI,IAAA,eAAJ,OAAA,SAAA,GAAgB,QAAQ;AACzD;AAEA,SAAS,4BACP,OACA,iBACmB;AACb,QAAA,EAAE,UAAA,IAAc;AACtB,MAAI,CAAC,UAAU;AACN,WAAA;AAET,QAAM,OAAO,UAAU;AACvB,QAAM,OAAO,KAAK;AACd,MAAA,KAAK,QAAQ,OAAO;AACf,WAAA;AAEH,QAAA,UAAU,WAAW,CAAAA,UAAQA,MAAK,KAAK,SAAS,OAAO,EAAE,IAAI;AAC/D,MAAA;AACK,WAAA;AAEH,QAAA,SAAS,KAAK,OAAO;AAE3B,SAAO,WAAW,KAAK,QAAQ,SAAS,KAAK,UAAU;IACrD,SAAS;IACT,oBAAoB;EAAA,CACrB;AACH;AASO,IAAM,oBAAoB,EAAK;EACpC,MAAM;EACN,MAAM;AACR,GAAwB,sBAAsB;AAEjC,IAAA,oBAAoB,GAAO,CAAC,QAAQ;AAC/C,SAAO,IAAI,OAAO;IAChB,KAAK,IAAI,UAAU,mBAAmB;IACtC,OAAO;MACL,aAAa,CAAC,UAAU;AAtD9B,YAAA;AAuDQ,cAAM,SAAS,IAAI,IAAI,kBAAkB,GAAG;AAC5C,YAAI,OAAO,SAAS,SAAS,CAAC,WAAW,MAAM,GAAG;AACzC,iBAAA;AAET,YAAI,cAAc,MAAM,SAAS,KAAK,SAAS,MAAM,SAAS;AACrD,iBAAA;AAEH,cAAA,mBAAkB,KAAO,OAAA,SAAP,OAAe,KAAA;AACjC,cAAA,OAAO,4BAA4B,OAAO,eAAe;AAC/D,YAAI,CAAC;AACI,iBAAA;AAET,eAAO,cAAc,OAAO,MAAM,KAAK,CAAC,IAAI,CAAC;MAAA;IAC/C;EACF,CACD;AACH,CAAC;AAEY,IAAA,gBAAyD,CAAC,QAAQ,WAAW;AAErF,SAAA,OAAO,CAAC,QAAQ;AACf,QAAI,QAAQ;AACV,UAAI,OAAO,kBAAkB,KAAK,CAAC,SAAS;AACnC,eAAA;UACL,GAAG;UACH,GAAG;QAAA;MACL,CACD;IAAA;EACH,CACD,EACA,IAAI,iBAAiB,EACrB,IAAI,iBAAiB;AAC1B;",
  "names": ["node"]
}
