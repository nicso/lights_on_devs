{"version":3,"file":"index-CMGDOz11.js","sources":["../../src/feature/placeholder/index.ts"],"sourcesContent":["import { $ctx, $prose } from '@milkdown/kit/utils'\nimport type { EditorState } from '@milkdown/kit/prose/state'\nimport { Plugin, PluginKey } from '@milkdown/kit/prose/state'\nimport type { Node } from '@milkdown/kit/prose/model'\nimport { Decoration, DecorationSet } from '@milkdown/kit/prose/view'\nimport { findParent } from '@milkdown/kit/prose'\nimport type { DefineFeature } from '../shared'\nimport { isInCodeBlock, isInList } from '../../utils'\n\nfunction isDocEmpty(doc: Node) {\n  return doc.childCount <= 1 && !doc.firstChild?.content.size\n}\n\nfunction createPlaceholderDecoration(\n  state: EditorState,\n  placeholderText: string,\n): Decoration | null {\n  const { selection } = state\n  if (!selection.empty)\n    return null\n\n  const $pos = selection.$anchor\n  const node = $pos.parent\n  if (node.content.size > 0)\n    return null\n\n  const inTable = findParent(node => node.type.name === 'table')($pos)\n  if (inTable)\n    return null\n\n  const before = $pos.before()\n\n  return Decoration.node(before, before + node.nodeSize, {\n    'class': 'crepe-placeholder',\n    'data-placeholder': placeholderText,\n  })\n}\n\ninterface PlaceholderConfig {\n  text: string\n  mode: 'doc' | 'block'\n}\n\nexport type PlaceHolderFeatureConfig = Partial<PlaceholderConfig>\n\nexport const placeholderConfig = $ctx({\n  text: 'Please enter...',\n  mode: 'block',\n} as PlaceholderConfig, 'placeholderConfigCtx')\n\nexport const placeholderPlugin = $prose((ctx) => {\n  return new Plugin({\n    key: new PluginKey('CREPE_PLACEHOLDER'),\n    props: {\n      decorations: (state) => {\n        const config = ctx.get(placeholderConfig.key)\n        if (config.mode === 'doc' && !isDocEmpty(state.doc))\n          return null\n\n        if (isInCodeBlock(state.selection) || isInList(state.selection))\n          return null\n\n        const placeholderText = config.text ?? 'Please enter...'\n        const deco = createPlaceholderDecoration(state, placeholderText)\n        if (!deco)\n          return null\n\n        return DecorationSet.create(state.doc, [deco])\n      },\n    },\n  })\n})\n\nexport const defineFeature: DefineFeature<PlaceHolderFeatureConfig> = (editor, config) => {\n  editor\n    .config((ctx) => {\n      if (config) {\n        ctx.update(placeholderConfig.key, (prev) => {\n          return {\n            ...prev,\n            ...config,\n          }\n        })\n      }\n    })\n    .use(placeholderPlugin)\n    .use(placeholderConfig)\n}\n"],"names":["node"],"mappings":"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"}